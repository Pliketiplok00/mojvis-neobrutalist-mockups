# MOJ VIS — ADMIN & SUPERVISOR WEB EDITOR BRIEF
(Admin/Supervisor UI, Permissions, Content Workflows)

This document defines the web-based editor for MOJ VIS (Admin + Supervisor roles),
including permissions, content workflows, Inbox messaging, notices, and transport/event tools.

---

## 1) Roles & Access Model

### Roles
- **Admin**
- **Supervisor** (superset)

### Municipal scopes (Vis/Komiža)
Some Admins are authorized as:
- **Vis Admin**
- **Komiža Admin**
- (Optionally both; if both, they can manage both municipalities)

Municipal scope affects access to municipal messages:
- A Vis Admin can view/edit municipal messages tagged **Vis**
- A Komiža Admin can view/edit municipal messages tagged **Komiža**
- Users without that scope must NOT see or edit those municipal messages

---

## 2) Publish Model (Immediate vs Approval)

### Immediate (live on save)
The following content is published immediately when saved:
- Inbox messages (all categories; subject to permissions)
- Events
- Transport metadata (contacts, external links, transport-context notice associations)

### Supervisor-only publishing (draft workflow)
- **Static content pages** use a draft + publish workflow:
  - Admin edits draft content (within allowed/ unlocked blocks)
  - Supervisor publishes changes
  - Supervisor can lock structure/content and control publishing
  - Static pages cannot be published unless validation passes (including EN requirement)

---

## 3) Inbox Messaging Model (Core)

### Key decision
The **Inbox is the single source of truth** for user-facing communication.

### Message taxonomy (final)
A message can have **up to 2 categories (tags)** from this set:

- **cestovni promet** (road transport)
- **pomorski promet** (sea transport)
- **kultura**
- **opcenito**
- **hitno** (emergency)
- **komiza** (municipal)
- **vis** (municipal)

Examples:
- `cestovni promet` + `hitno`
- `kultura` + `vis`

### Notices
There is no separate “notice” entity.
A “notice” is any Inbox message that includes the **hitno** tag.

### Active window (required for time-bound banners)
Messages may include an active window:
- `active_from`
- `active_to`

Used to determine whether banners appear in the app and where.

### Reminders (system-generated)
Event reminders are not created by admins.
They are generated by the system based on user action (remind me) and delivered into Inbox.

---

## 4) Messaging Permissions & Constraints

### Who can create which messages
- **Hitno (Emergency)** messages:
  - Created by Admins (and Supervisors)
  - Any message with the `hitno` tag is treated as emergency/notice

- **Municipal messages** (`vis` / `komiza`):
  - Can only be created/edited/viewed by admins with that municipal authorization
  - Supervisor can also manage municipal messages (unless explicitly restricted later)

### Visibility / edit constraints (municipal)
- Municipal messages are not globally visible in admin UI.
- Only authorized users (Vis Admin / Komiža Admin / Supervisor) can:
  - view
  - edit
  - publish (if applicable; messages are immediate-live on save)

---

## 5) Admin Web App Screens (Minimum)

### A) Login
- Web login required for Admin/Supervisor.

### B) Dashboard
- Quick links to:
  - Messages (Inbox)
  - Events
  - Static Pages (CMS)
  - Transport (Road/Sea)
  - Audit log (optional but recommended)

### C) Messages (Inbox) — Admin View
- List view with filters:
  - category tags (multi-select)
  - municipality scope (only shows allowed municipal tags)
  - active now / scheduled / expired (based on active_from/to)
- Message composer:
  - subject/title (HR/EN where applicable)
  - body/content (HR/EN where applicable)
  - tags: select up to 2 from the final taxonomy
  - active_from / active_to (optional unless required by rules below)
  - attachments optional (if supported later)
- Message detail view:
  - full content
  - timestamps: created_at, updated_at, published_at (if tracked)
  - active window
  - status indicators (active / inactive)

### D) Events
- Create/edit events (HR/EN required to publish)
- Event reminders: viewable (read-only), system-generated

### E) Static Pages (CMS)
- Draft editing for Admin within allowed blocks
- Supervisor controls:
  - add/remove/reorder blocks
  - lock structure/content
  - publish/unpublish
- Validation:
  - cannot publish without EN
  - obey layout constraints (max 1 map block, etc.)

### F) Transport (Road/Sea)
- Timetables themselves are supervisor/back-end import controlled.
- Admin can manage:
  - contacts (per transport type and/or per line)
  - external links per line
  - contextual notice associations (see below)

### G) Audit Log (MVP minimum)
Minimum audit log fields:
- who (admin user)
- what entity (message/event/page/transport metadata)
- what action (create/edit/publish)
- when (timestamp)

Scope clarification:
- Audit logging is **minimal**: who / what / when / entity only
- **No full diff history** required
- **No enterprise-grade auditing** (versioning, rollback, change tracking)
- Purpose is accountability, not forensic reconstruction

---

## 6) Banner & Contextual Notice Rules (Web Editor Responsibilities)

### App banner behavior dependency
Banners shown in the mobile app depend on:
- message active window (active_from → active_to)
- message categories/tags
- user mode and municipal selection rules (handled in app)

### Contextual associations (Transport)
Admin can link messages to transport context so the app can show the right banner:
- Road Transport screens: show banners for messages tagged `cestovni promet` (and/or `hitno`)
- Sea Transport screens: show banners for messages tagged `pomorski promet` (and/or `hitno`)

Implementation note:
- If a message has `hitno`, it is eligible for emergency banners wherever applicable.
- If a message has transport tag + active window, it must surface on relevant transport screens.

---

## 7) Localization Rules (Admin UI + Content)

### Content localization
- All publishable content requires HR and EN, including:
  - events
  - static pages
  - general messages

Exception:
- Municipal messages (`vis` / `komiza`) may be single-language if required.

### Admin UI localization (MVP decision)
- The Admin/Supervisor web editor is **HR-only for MVP**
- Admin UI does NOT require English translation in V1
- This applies to: labels, buttons, error messages, form fields, navigation
- Mobile app remains **strictly HR + EN** (both languages required)

---

## 8) Definition of Done (Admin/Supervisor)

A feature is complete only if:
- Permissions are enforced (especially municipal scope)
- Message categories support up to 2 tags
- Active window supports banner logic (from/to)
- Static pages require supervisor publish and pass validations
- Events and messages save/publish according to the publish model
- Audit log records create/edit/publish actions

---
